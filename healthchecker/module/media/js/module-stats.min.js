/**
 * Health Checker Module - Stats Loading and Refresh
 *
 * @copyright   (C) 2026 https://mySites.guru + Phil E. Taylor <phil@phil-taylor.com>
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */
!function(e,t){"use strict";t.addEventListener("DOMContentLoaded",function(){t.querySelectorAll(".mod-healthchecker").forEach(function(n){const r=n.id,a=n.dataset.statsUrl,s=n.dataset.lastCheckedText;if(!r||!a)return;const o=t.getElementById(r+"-loading"),c=t.getElementById(r+"-error"),d=t.getElementById(r+"-error-message"),i=t.getElementById(r+"-results"),l=t.getElementById(r+"-timestamp");async function h(){try{const e=await fetch(a,{method:"GET",headers:{Accept:"application/json"}});if(o.classList.add("d-none"),!e.ok){const t=e.statusText||"HTTP Error";throw new Error(`${t} (${e.status})`)}const n=await e.text();let h;try{h=JSON.parse(n)}catch(e){const t=n.substring(0,100).replace(/</g,"&lt;").replace(/>/g,"&gt;");throw new Error(`Invalid JSON response: ${t}${n.length>100?"...":""}`)}if(!h.success)return d.textContent=h.message||"Unknown error occurred",void c.classList.remove("d-none");if(!h.data||"object"!=typeof h.data)throw new Error("Invalid response data structure");const m=t.getElementById(r+"-critical"),u=t.getElementById(r+"-warning"),f=t.getElementById(r+"-good");if(m&&(m.textContent=h.data.critical||0),u&&(u.textContent=h.data.warning||0),f&&(f.textContent=h.data.good||0),i.classList.remove("d-none"),h.data.lastRun){const e=new Date(h.data.lastRun).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"medium"});l.textContent=s.replace("%s",e),l.classList.remove("d-none")}}catch(e){let t;o.classList.add("d-none"),t="TypeError"===e.name&&e.message.includes("Failed to fetch")?"Network error: Unable to connect to server":e.message?e.message:"An unexpected error occurred",d.textContent=t,c.classList.remove("d-none"),console.error("Health Checker Module Error:",e)}}h(),t.querySelectorAll("#"+r+" .healthchecker-card").forEach(n=>{n.addEventListener("click",async r=>{if(!t.startViewTransition)return;r.preventDefault();const a=n.getAttribute("href");t.startViewTransition(()=>{e.location.href=a})})}),function(){const e=t.getElementById(r+"-refresh");e&&e.addEventListener("click",async()=>{e.disabled=!0;const t=e.querySelector(".icon-refresh");t&&t.classList.add("fa-spin"),i.classList.add("d-none"),c.classList.add("d-none"),o.classList.remove("d-none");try{const e=a.replace("task=ajax.stats","task=ajax.clearCache");if(!(await fetch(e)).ok)throw new Error("Failed to clear cache");await h()}catch(e){o.classList.add("d-none"),d.textContent="Failed to refresh: "+(e.message||"Unknown error"),c.classList.remove("d-none"),console.error("Health Checker Refresh Error:",e)}finally{e.disabled=!1,t&&t.classList.remove("fa-spin")}})}()})})}(window,document);
//# sourceMappingURL=module-stats.min.js.map