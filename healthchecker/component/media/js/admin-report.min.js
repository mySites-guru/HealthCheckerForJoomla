/**
 * Health Checker Component - Report Admin JavaScript
 *
 * @copyright   (C) 2026 https://mySites.guru + Phil E. Taylor <phil@phil-taylor.com>
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */
!function(e,t){"use strict";e.HealthCheckerReport={init:function(s){const a=s.metadataUrl,n=(s.checkUrl,s.categoryUrl),r="healthchecker_filters",c=s.translations||{};let o={categories:{},providers:{},checks:[],results:{}},l=0,i=0;async function d(){const s=t.getElementById("health-check-loading"),r=t.getElementById("health-check-error"),d=t.getElementById("health-check-results"),p=t.getElementById("loading-progress");s.classList.remove("d-none"),r.classList.add("d-none"),d.classList.add("d-none"),t.getElementById("critical-count").textContent="-",t.getElementById("warning-count").textContent="-",t.getElementById("good-count").textContent="-",o={categories:{},providers:{},checks:[],results:{}},l=0,i=0;try{p.textContent=c.loading||"Loading...";const r=await fetch(a,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}),l=await r.json();if(!l.success)throw new Error(l.message||"Failed to load metadata");o.categories=l.data.categories,o.providers=l.data.providers,o.checks=l.data.checks,i=o.checks.length,function(s){const a=t.getElementById("filter_category");for(;a.options.length>1;)a.remove(1);Object.values(s).sort((e,t)=>e.sortOrder-t.sortOrder).forEach(e=>{const s=t.createElement("option");s.value=e.slug,s.textContent=e.label,a.appendChild(s)}),e._pendingCategoryFilter&&(a.value=e._pendingCategoryFilter,e._pendingCategoryFilter="")}(o.categories),d.classList.remove("d-none"),h(),function(e){const s=Object.values(e).filter(e=>"core"!==e.slug),a=t.getElementById("third-party-providers"),n=t.getElementById("providers-list");if(0===s.length)return void a.classList.add("d-none");a.classList.remove("d-none"),n.innerHTML="",s.forEach(e=>{let t="";e.logoUrl?t=`<img src="${y(e.logoUrl)}" alt="" class="me-2" style="width: 32px; height: 32px; object-fit: contain; border-radius: 4px;">`:e.icon&&(t=`<span class="fa ${e.icon} me-2 fs-4" aria-hidden="true"></span>`);let s=y(e.name);e.url&&(s=`<a href="${y(e.url)}" target="_blank" rel="noopener">${s} <span class="icon-out-2 small" aria-hidden="true"></span></a>`),n.innerHTML+=`\n                        <div class="col-md-4 mb-2">\n                            <div class="d-flex align-items-start">\n                                ${t}\n                                <div>\n                                    <strong>${s}</strong>\n                                    ${e.version?`<span class="text-muted">v${y(e.version)}</span>`:""}\n                                    ${e.description?`<div class="small text-muted">${y(e.description)}</div>`:""}\n                                </div>\n                            </div>\n                        </div>\n                    `})}(o.providers);const m=Object.keys(o.categories),f=m.length;p.textContent=`0 / ${f} categories`;const v=m.map((e,t)=>async function(e,t,s,a){try{a.textContent=`Running ${o.categories[e].label||e} (${t}/${s})`;const r=new FormData;r.append("category",e);const c=await fetch(n,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:r,credentials:"same-origin"}),l=await c.json();l.success&&l.data&&l.data.results&&(Object.entries(l.data.results).forEach(([e,t])=>{o.results[e]=t,g(e,t)}),u())}catch(t){console.error(`Failed to run category ${e}:`,t)}}(e,t+1,f,p));await Promise.all(v),s.classList.add("d-none"),h(),u(),t.getElementById("last-checked").textContent=(c.lastChecked||"Last checked: %s").replace("%s",(new Date).toLocaleString())}catch(e){s.classList.add("d-none"),r.classList.remove("d-none"),t.getElementById("health-check-error-message").textContent=e.message||"Network error"}}function g(e,s){const a=t.getElementById(`check-row-${e.replace(/\./g,"-")}`);if(!a)return;const n=f(s.status),r=o.providers[s.provider];let l="";"core"!==s.provider&&r&&(l=`<span class="badge bg-secondary hasTooltip" title="${y(r.name+(r.version?" v"+r.version:""))}">${y(r.name)}</span>`),a.innerHTML=`\n                    <td>\n                        <span class="badge ${n.badgeClass}">\n                            <span class="fa ${n.icon}" aria-hidden="true"></span>\n                            ${n.label}\n                        </span>\n                    </td>\n                    <td>${y(s.title)}</td>\n                    <td>${l}</td>\n                    <td>${y(s.description)}</td>\n                `,function(e){const s=t.getElementById(`category-card-${e}`);if(!s)return;const a=Object.values(o.results).filter(t=>t.category===e),n=a.some(e=>"critical"===e.status),r=a.some(e=>"warning"===e.status);s.classList.remove("border-danger","border-warning","border-success"),n?s.classList.add("border-danger"):r?s.classList.add("border-warning"):a.length>0&&s.classList.add("border-success");!function(e){const s=t.getElementById(`category-badges-${e}`);if(!s)return;const a=Object.values(o.results).filter(t=>t.category===e),n=a.filter(e=>"critical"===e.status).length,r=a.filter(e=>"warning"===e.status).length,l=a.filter(e=>"good"===e.status).length;let i="";n>0&&(i+=`<span class="badge bg-danger">${n} ${c.critical||"Critical"}</span> `);r>0&&(i+=`<span class="badge bg-warning text-dark">${r} ${c.warning||"Warning"}</span> `);l>0&&(i+=`<span class="badge bg-success">${l} ${c.good||"Good"}</span>`);s.innerHTML=i}(e)}(s.category)}function u(){const e=Object.values(o.results),s=e.filter(e=>"critical"===e.status).length,a=e.filter(e=>"warning"===e.status).length,n=e.filter(e=>"good"===e.status).length;t.getElementById("critical-count").textContent=s,t.getElementById("warning-count").textContent=a,t.getElementById("good-count").textContent=n}function h(){const e=t.getElementById("healthCheckCategories");e.innerHTML="";const s=t.getElementById("filter_search").value.toLowerCase().trim(),a=t.getElementById("filter_status").value,n=t.getElementById("filter_category").value,r=Object.values(o.categories).sort((e,t)=>e.sortOrder-t.sortOrder);r.forEach(t=>{if(n&&t.slug!==n)return;let r=o.checks.filter(e=>e.category===t.slug);if(0===r.length)return;const l=Object.values(o.results).filter(e=>e.category===t.slug);let i=l;if(a&&(i="hide_good"===a?l.filter(e=>"good"!==e.status):l.filter(e=>e.status===a),0===i.length&&l.length>0))return;if(s&&(i=i.filter(e=>e.title.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.slug.toLowerCase().includes(s)),0===i.length))return;const d=l.filter(e=>"critical"===e.status).length,g=l.filter(e=>"warning"===e.status).length,u=l.filter(e=>"good"===e.status).length;let h="";d>0?h="border-danger":g>0?h="border-warning":u>0&&(h="border-success");let p="";d>0&&(p+=`<span class="badge bg-danger">${d} ${c.critical||"Critical"}</span> `),g>0&&(p+=`<span class="badge bg-warning text-dark">${g} ${c.warning||"Warning"}</span> `),u>0&&(p+=`<span class="badge bg-success">${u} ${c.good||"Good"}</span>`);let m=r;if(a||s){i.map(e=>e.slug);m=r.filter(e=>{const t=o.results[e.slug];if(!t)return!1;let n=!0;a&&(n="hide_good"===a?"good"!==t.status:t.status===a);let r=!s||t.title.toLowerCase().includes(s)||t.description.toLowerCase().includes(s)||t.slug.toLowerCase().includes(s);return n&&r})}let v="";m.forEach(e=>{const t=o.results[e.slug],s=`check-row-${e.slug.replace(/\./g,"-")}`;if(t){const e=f(t.status),a=o.providers[t.provider];let n="";"core"!==t.provider&&a&&(n=`<span class="badge bg-secondary hasTooltip" title="${y(a.name+(a.version?" v"+a.version:""))}">${y(a.name)}</span>`),v+=`\n                                <tr id="${s}">\n                                    <td>\n                                        <span class="badge ${e.badgeClass}">\n                                            <span class="fa ${e.icon}" aria-hidden="true"></span>\n                                            ${e.label}\n                                        </span>\n                                    </td>\n                                    <td>${y(t.title)}</td>\n                                    <td>${n}</td>\n                                    <td>${y(t.description)}</td>\n                                </tr>\n                            `}else v+=`\n                                <tr id="${s}">\n                                    <td>\n                                        <span class="badge bg-secondary">\n                                            <span class="spinner-border spinner-border-sm" role="status"></span>\n                                        </span>\n                                    </td>\n                                    <td>${y(e.title)}</td>\n                                    <td></td>\n                                    <td class="text-muted">${c.runningChecks||"Running checks..."}</td>\n                                </tr>\n                            `});const b=t.label;let $="";t.logoUrl?$=`<img src="${y(t.logoUrl)}" alt="" class="me-2" style="width: 24px; height: 24px; object-fit: contain; border-radius: 4px;">`:t.icon&&($=`<span class="fa ${t.icon} me-2" aria-hidden="true"></span>`);const E="true"===localStorage.getItem(`healthchecker-category-${t.slug}-collapsed`),L=E?"":"show",w=E?"fa-chevron-right":"fa-chevron-down";e.innerHTML+=`\n                        <div class="card mb-3 ${h}" id="category-card-${t.slug}">\n                            <div class="card-header d-flex justify-content-between align-items-center"\n                                 style="cursor: pointer;"\n                                 role="button"\n                                 data-bs-toggle="collapse"\n                                 data-bs-target="#category-collapse-${t.slug}"\n                                 aria-expanded="${!E}"\n                                 aria-controls="category-collapse-${t.slug}">\n                                <h5 class="mb-0 d-flex align-items-center">\n                                    <span class="fa ${w} me-2" aria-hidden="true" id="category-chevron-${t.slug}"></span>\n                                    ${$}\n                                    ${y(b)}\n                                </h5>\n                                <span id="category-badges-${t.slug}">${p}</span>\n                            </div>\n                            <div class="collapse ${L}" id="category-collapse-${t.slug}">\n                                <div class="card-body p-0">\n                                    <table class="table table-striped mb-0">\n                                        <colgroup>\n                                            <col style="width: 100px;">\n                                            <col style="width: 300px;">\n                                            <col style="width: 150px;">\n                                            <col>\n                                        </colgroup>\n                                        <tbody>${v}</tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    `}),new bootstrap.Tooltip(t.body,{selector:".hasTooltip"}),r.forEach(e=>{const s=t.getElementById(`category-collapse-${e.slug}`),a=t.getElementById(`category-chevron-${e.slug}`);s&&a&&(s.addEventListener("shown.bs.collapse",function(){localStorage.setItem(`healthchecker-category-${e.slug}-collapsed`,"false"),a.classList.remove("fa-chevron-right"),a.classList.add("fa-chevron-down")}),s.addEventListener("hidden.bs.collapse",function(){localStorage.setItem(`healthchecker-category-${e.slug}-collapsed`,"true"),a.classList.remove("fa-chevron-down"),a.classList.add("fa-chevron-right")}))})}function p(){!function(){const s={search:t.getElementById("filter_search").value,status:t.getElementById("filter_status").value,category:t.getElementById("filter_category").value};localStorage.setItem(r,JSON.stringify(s));const a=new URL(e.location);s.search?a.searchParams.set("search",s.search):a.searchParams.delete("search"),s.status?a.searchParams.set("status",s.status):a.searchParams.delete("status"),s.category?a.searchParams.set("category",s.category):a.searchParams.delete("category"),e.history.replaceState({},"",a)}(),m(),h()}function m(){const e=t.getElementById("filter_status").value;t.querySelectorAll(".status-filter-card").forEach(t=>{const s=t.dataset.status;t.classList.remove("active","dimmed"),e&&(e===s?t.classList.add("active"):"hide_good"===e&&"good"!==s||t.classList.add("dimmed"),"hide_good"===e&&"good"===s&&t.classList.add("dimmed"))})}function f(e){const t={critical:{label:c.critical||"Critical",icon:"fa-times-circle",badgeClass:"bg-danger"},warning:{label:c.warning||"Warning",icon:"fa-exclamation-triangle",badgeClass:"bg-warning text-dark"},good:{label:c.good||"Good",icon:"fa-check-circle",badgeClass:"bg-success"}};return t[e]||t.good}function y(e){const s=t.createElement("div");return s.textContent=e,s.innerHTML}!function(){const s=new URL(e.location),a=s.searchParams.get("search"),n=s.searchParams.get("status"),c=s.searchParams.get("category");let o={search:"",status:"",category:""};const l=localStorage.getItem(r);if(l)try{o=JSON.parse(l)}catch(e){}null!==a&&(o.search=a),null!==n&&(o.status=n),null!==c&&(o.category=c),t.getElementById("filter_search").value=o.search||"",t.getElementById("filter_status").value=o.status||"",e._pendingCategoryFilter=o.category||""}(),m(),d(),t.getElementById("filter_search").addEventListener("input",p),t.getElementById("filter_status").addEventListener("change",p),t.getElementById("filter_category").addEventListener("change",p),t.querySelectorAll(".status-filter-card").forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.status,s=t.getElementById("filter_status");s.value===e?s.value="":s.value=e,p()})});const v=t.getElementById("retry-health-check");v&&v.addEventListener("click",function(){d()}),e.runHealthChecks=d}},t.addEventListener("DOMContentLoaded",function(){const s=t.getElementById("adminForm");if(!s)return;const a=s.dataset.metadataUrl,n=s.dataset.checkUrl,r=s.dataset.categoryUrl;a&&n&&r&&e.HealthCheckerReport.init({metadataUrl:a,checkUrl:n,categoryUrl:r,translations:{loading:s.dataset.textLoading||"Loading...",lastChecked:s.dataset.textLastChecked||"Last checked: %s",runningChecks:s.dataset.textRunningChecks||"Running checks...",critical:s.dataset.textCritical||"Critical",warning:s.dataset.textWarning||"Warning",good:s.dataset.textGood||"Good"}})})}(window,document);
//# sourceMappingURL=admin-report.min.js.map